{
  "Column": [
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "Id",
      "system_type_id": 56,
      "user_type_id": 56,
      "max_length": 4,
      "precision": 10,
      "scale": 0,
      "collation_name": null,
      "is_nullable": false,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": true,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "MeterNum",
      "system_type_id": 167,
      "user_type_id": 167,
      "max_length": 50,
      "precision": 0,
      "scale": 0,
      "collation_name": "SQL_Latin1_General_CP1_CI_AS",
      "is_nullable": false,
      "is_ansi_padded": true,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "Amount",
      "system_type_id": 60,
      "user_type_id": 60,
      "max_length": 8,
      "precision": 19,
      "scale": 4,
      "collation_name": null,
      "is_nullable": false,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "TrxId",
      "system_type_id": 127,
      "user_type_id": 127,
      "max_length": 8,
      "precision": 19,
      "scale": 0,
      "collation_name": null,
      "is_nullable": false,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "TrxTypeId",
      "system_type_id": 56,
      "user_type_id": 56,
      "max_length": 4,
      "precision": 10,
      "scale": 0,
      "collation_name": null,
      "is_nullable": false,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "DateIn",
      "system_type_id": 61,
      "user_type_id": 61,
      "max_length": 8,
      "precision": 23,
      "scale": 3,
      "collation_name": null,
      "is_nullable": true,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 1069246864,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "Used",
      "system_type_id": 127,
      "user_type_id": 127,
      "max_length": 8,
      "precision": 19,
      "scale": 0,
      "collation_name": null,
      "is_nullable": true,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 1085246921,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "DateOut",
      "system_type_id": 61,
      "user_type_id": 61,
      "max_length": 8,
      "precision": 23,
      "scale": 3,
      "collation_name": null,
      "is_nullable": true,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "OriginalTrxId",
      "system_type_id": 127,
      "user_type_id": 127,
      "max_length": 8,
      "precision": 19,
      "scale": 0,
      "collation_name": null,
      "is_nullable": true,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 1053246807,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "ModifiedUser",
      "system_type_id": 167,
      "user_type_id": 167,
      "max_length": 50,
      "precision": 0,
      "scale": 0,
      "collation_name": "SQL_Latin1_General_CP1_CI_AS",
      "is_nullable": true,
      "is_ansi_padded": true,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "ModifiedDate",
      "system_type_id": 61,
      "user_type_id": 61,
      "max_length": 8,
      "precision": 23,
      "scale": 3,
      "collation_name": null,
      "is_nullable": true,
      "is_ansi_padded": false,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    },
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "BinReason",
      "system_type_id": 167,
      "user_type_id": 167,
      "max_length": 50,
      "precision": 0,
      "scale": 0,
      "collation_name": "SQL_Latin1_General_CP1_CI_AS",
      "is_nullable": true,
      "is_ansi_padded": true,
      "is_rowguidcol": false,
      "is_identity": false,
      "is_computed": false,
      "is_filestream": false,
      "is_replicated": false,
      "is_non_sql_subscribed": false,
      "is_merge_published": false,
      "is_dts_replicated": false,
      "is_xml_document": false,
      "xml_collection_id": 0,
      "default_object_id": 0,
      "rule_object_id": 0,
      "is_sparse": false,
      "is_column_set": false,
      "generated_always_type": 0,
      "generated_always_type_desc": "NOT_APPLICABLE",
      "encryption_type": null,
      "encryption_type_desc": null,
      "encryption_algorithm_name": null,
      "column_encryption_key_id": null,
      "column_encryption_key_database_name": null,
      "is_hidden": false,
      "is_masked": false,
      "graph_type": null,
      "graph_type_desc": null
    }
  ],
  "Foreign keys": [],
  "Check constraints": [],
  "Triggers": [
    {
      "schem": "dbo",
      "obj": "TrxElectricityBin",
      "type": "Table",
      "name": "utr_TrxElectricityBin_ChangeTracking",
      "object_id": 1522820487,
      "parent_class": 1,
      "parent_class_desc": "OBJECT_OR_COLUMN",
      "parent_id": 1371151930,
      "type_desc": "SQL_TRIGGER",
      "create_date": "2021-07-08T13:16:19.143",
      "modify_date": "2021-07-08T13:16:19.143",
      "is_ms_shipped": false,
      "is_disabled": false,
      "is_not_for_replication": false,
      "is_instead_of_trigger": false,
      "Events": [
        {
          "object_id": 1522820487,
          "type": 1,
          "type_desc": "INSERT",
          "is_first": false,
          "is_last": false,
          "event_group_type": null,
          "event_group_type_desc": null,
          "is_trigger_event": true
        },
        {
          "object_id": 1522820487,
          "type": 2,
          "type_desc": "UPDATE",
          "is_first": false,
          "is_last": false,
          "event_group_type": null,
          "event_group_type_desc": null,
          "is_trigger_event": true
        },
        {
          "object_id": 1522820487,
          "type": 3,
          "type_desc": "DELETE",
          "is_first": false,
          "is_last": false,
          "event_group_type": null,
          "event_group_type_desc": null,
          "is_trigger_event": true
        }
      ],
      "Models": [
        {
          "object_id": 1522820487,
          "definition": "\r\n \r\n\r\n \r\n\r\nCREATE TRIGGER [dbo].[utr_TrxElectricityBin_ChangeTracking] ON [dbo].[TrxElectricityBin]\r\n\r\n \r\n\r\nFOR INSERT, DELETE, UPDATE\r\n\r\n \r\n\r\nAS\r\n\r\n \r\n\r\n      SET NOCOUNT ON;\r\n\r\n \r\n\r\n \r\n\r\nIF EXISTS(SELECT TOP 1 ModifiedUser FROM  inserted i WHERE ModifiedUser IS NOT NULL) OR\r\n\r\n    EXISTS(SELECT TOP 1 ModifiedUser FROM  deleted d WHERE ModifiedUser IS NOT NULL)\r\n\r\n   BEGIN\r\n\r\n      DECLARE @bit INT, @field INT, @maxfield INT, @char INT, @fieldname VARCHAR(128), @TableName VARCHAR(128),\r\n\r\n          @PKCols VARCHAR(1000), @sql VARCHAR(2000), @UpdateDate VARCHAR(50), @DBUserName VARCHAR(128), @Type CHAR(1),\r\n\r\n          @PKFieldSelect VARCHAR(1000), @PKValueSelect VARCHAR(1000), @temp1 VARCHAR(1000), @temp2 VARCHAR(1000),\r\n\r\n          @ModifiedUser VARCHAR(50), @AuditId UNIQUEIDENTIFIER;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT @TableName = 'TrxElectricityBin';\r\n\r\n \r\n\r\n\r\n \r\n\r\n      -- date and user\r\n\r\n \r\n\r\n      SELECT @DBUserName = system_user;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SET @AuditId = NEWID();\r\n\r\n \r\n\r\n\r\n \r\n\r\n      -- Action\r\n\r\n \r\n\r\n      IF EXISTS\r\n\r\n \r\n\r\n      (\r\n\r\n \r\n\r\n            SELECT Id\r\n\r\n \r\n\r\n            FROM inserted\r\n\r\n \r\n\r\n      )\r\n\r\n \r\n\r\n            IF EXISTS\r\n\r\n \r\n\r\n            (\r\n\r\n \r\n\r\n                  SELECT Id\r\n\r\n \r\n\r\n                  FROM deleted\r\n\r\n \r\n\r\n            )\r\n\r\n \r\n\r\n                  SELECT @Type = 'U';\r\n\r\n \r\n\r\n            ELSE\r\n\r\n \r\n\r\n            SELECT @Type = 'I';;\r\n\r\n \r\n\r\n      ELSE\r\n\r\n \r\n\r\n      SELECT @Type = 'D';\r\n\r\n \r\n\r\n\r\n \r\n\r\n      -- get list of columns\r\n\r\n \r\n\r\n      SELECT [Id],\r\n\r\n \r\n\r\n                  [MeterNum],\r\n\r\n \r\n\r\n                  [Amount],\r\n\r\n \r\n\r\n                  [TrxId],\r\n\r\n \r\n\r\n                  [TrxTypeId],\r\n\r\n \r\n\r\n                  [DateIn],\r\n\r\n \r\n\r\n                  [Used],\r\n\r\n \r\n\r\n                  [DateOut],\r\n\r\n \r\n\r\n                  [OriginalTrxId],\r\n\r\n \r\n\r\n                  [ModifiedUser],\r\n\r\n \r\n\r\n                  [ModifiedDate],\r\n\r\n \r\n\r\n                  [BinReason]\r\n\r\n \r\n\r\n      INTO #ins\r\n\r\n \r\n\r\n      FROM inserted\r\n\r\n \r\n\r\n      WHERE [ModifiedUser] is not null;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT TOP 1 @ModifiedUser = ModifiedUser\r\n\r\n \r\n\r\n      FROM #ins;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SET @ModifiedUser = ISNULL(@ModifiedUser, '');\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT [Id],\r\n\r\n \r\n\r\n                  [MeterNum],\r\n\r\n \r\n\r\n                  [Amount],\r\n\r\n \r\n\r\n                  [TrxId],\r\n\r\n \r\n\r\n                  [TrxTypeId],\r\n\r\n \r\n\r\n                  [DateIn],\r\n\r\n \r\n\r\n                  [Used],\r\n\r\n \r\n\r\n                  [DateOut],\r\n\r\n \r\n\r\n                  [OriginalTrxId],\r\n\r\n \r\n\r\n                  [ModifiedUser],\r\n\r\n \r\n\r\n                  [ModifiedDate],\r\n\r\n \r\n\r\n                  [BinReason]\r\n\r\n \r\n\r\n      INTO #del\r\n\r\n \r\n\r\n      FROM deleted\r\n\r\n \r\n\r\n      WHERE [ModifiedUser] is not null;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      IF(@ModifiedUser IS NULL)\r\n\r\n \r\n\r\n            SELECT TOP 1 @ModifiedUser = ModifiedUser\r\n\r\n \r\n\r\n            FROM #del;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      -- Get primary key columns for full outer join - d alias will be used later\r\n\r\n \r\n\r\n      SELECT @PKCols = COALESCE(@PKCols+' and', ' on')+' i.'+c.COLUMN_NAME+' = d.'+c.COLUMN_NAME\r\n\r\n \r\n\r\n      FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk INNER JOIN\r\n\r\n \r\n\r\n              INFORMATION_SCHEMA.KEY_COLUMN_USAGE c ON c.TABLE_NAME = pk.TABLE_NAME\r\n\r\n \r\n\r\n               AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME\r\n\r\n \r\n\r\n      WHERE pk.TABLE_NAME = @TableName\r\n\r\n \r\n\r\n               AND CONSTRAINT_TYPE = 'PRIMARY KEY'\r\n\r\n \r\n\r\n              \r\n\r\n \r\n\r\n\r\n \r\n\r\n      --PRINT '@PKCols'\r\n\r\n \r\n\r\n      --PRINT @PKCols\r\n\r\n \r\n\r\n\r\n \r\n\r\n      -- Get primary key fields select for insert\r\n\r\n \r\n\r\n      --select @PKFieldSelect =  coalesce(@PKFieldSelect,',') + COLUMN_NAME\r\n\r\n \r\n\r\n      SELECT @PKFieldSelect = COALESCE(@PKFieldSelect+''+'', '''')+''+COLUMN_NAME+''''\r\n\r\n \r\n\r\n      FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk INNER JOIN\r\n\r\n \r\n\r\n              INFORMATION_SCHEMA.KEY_COLUMN_USAGE c ON c.TABLE_NAME = pk.TABLE_NAME\r\n\r\n \r\n\r\n               AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME\r\n\r\n \r\n\r\n      WHERE pk.TABLE_NAME = @TableName\r\n\r\n \r\n\r\n               AND CONSTRAINT_TYPE = 'PRIMARY KEY'\r\n\r\n \r\n\r\n             \r\n\r\n \r\n\r\n\r\n \r\n\r\n      --PRINT '@PKFieldSelect'\r\n\r\n \r\n\r\n      --PRINT @PKFieldSelect\r\n\r\n \r\n\r\n\r\n \r\n\r\n      --Get the values        ''\r\n\r\n \r\n\r\n      SELECT @temp1 = 'convert(varchar(100), coalesce(i.';\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT @temp2 = ',d.';\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT @PKValueSelect = @temp1+COLUMN_NAME+@temp2+COLUMN_NAME+'))'\r\n\r\n \r\n\r\n      FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk INNER JOIN\r\n\r\n \r\n\r\n              INFORMATION_SCHEMA.KEY_COLUMN_USAGE c ON c.TABLE_NAME = pk.TABLE_NAME\r\n\r\n \r\n\r\n               AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME\r\n\r\n \r\n\r\n      WHERE pk.TABLE_NAME = @TableName\r\n\r\n \r\n\r\n               AND CONSTRAINT_TYPE = 'PRIMARY KEY'\r\n\r\n \r\n\r\n\r\n \r\n\r\n      --PRINT '@PKValueSelect'\r\n\r\n \r\n\r\n      --PRINT @PKValueSelect\r\n\r\n \r\n\r\n\r\n \r\n\r\n      IF @PKCols IS NULL\r\n\r\n \r\n\r\n            BEGIN\r\n\r\n \r\n\r\n                  RAISERROR('no PK on table %s', 16, -1, @TableName);\r\n\r\n \r\n\r\n\r\n \r\n\r\n                  RETURN;\r\n\r\n \r\n\r\n            END;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      SELECT @field = 0,\r\n\r\n \r\n\r\n                  @maxfield = MAX(ORDINAL_POSITION)\r\n\r\n \r\n\r\n      FROM INFORMATION_SCHEMA.COLUMNS\r\n\r\n \r\n\r\n      WHERE TABLE_NAME = @TableName;\r\n\r\n \r\n\r\n\r\n \r\n\r\n      --Test Code must be removed\r\n\r\n \r\n\r\n      SELECT @UpdateDate = CONVERT( VARCHAR(24), GETDATE(), 121);\r\n\r\n \r\n\r\n\r\n \r\n\r\n      WHILE @field < @maxfield\r\n\r\n \r\n\r\n            BEGIN\r\n\r\n \r\n\r\n                  SELECT @field = MIN(ORDINAL_POSITION)\r\n\r\n \r\n\r\n                  FROM INFORMATION_SCHEMA.COLUMNS\r\n\r\n \r\n\r\n                  WHERE TABLE_NAME = @TableName\r\n\r\n \r\n\r\n                           AND ORDINAL_POSITION > @field;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                  SELECT @bit = (@field - 1) % 8 + 1;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                  SELECT @bit = POWER(2, @bit - 1);\r\n\r\n \r\n\r\n\r\n \r\n\r\n                  SELECT @char = ((@field - 1) / 8) + 1;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                  -- if substring(COLUMNS_UPDATED(),@char, 1) & @bit > 0 or @Type in ('I','D')\r\n\r\n \r\n\r\n                  IF @Type IN('I', 'D', 'U')\r\n\r\n \r\n\r\n                        BEGIN\r\n\r\n \r\n\r\n                              SELECT @fieldname = COLUMN_NAME\r\n\r\n \r\n\r\n                              FROM INFORMATION_SCHEMA.COLUMNS\r\n\r\n \r\n\r\n                              WHERE TABLE_NAME = @TableName\r\n\r\n \r\n\r\n                                       AND ORDINAL_POSITION = @field\r\n\r\n \r\n\r\n                                       AND DATA_TYPE <> 'text'\r\n\r\n \r\n\r\n                                       AND (CHARACTER_MAXIMUM_LENGTH IS NULL\r\n\r\n \r\n\r\n                                                OR CHARACTER_MAXIMUM_LENGTH <= 500);\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = 'insert Audit (Type, TableName,PrimaryKeyField, PrimaryKeyValue, FieldName, OldValue, NewValue, ModifiedDate, DBUserName, ModifiedUser, AuditId )';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+' select '+''''+@Type+''',';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+''''+@TableName+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+@PKFieldSelect;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+@PKValueSelect;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+''''+@fieldname+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+',convert(varchar(1000),d.'+@fieldname+')';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+',convert(varchar(1000),i.'+@fieldname+')';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+''''+@UpdateDate+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+''''+@DBUserName+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+''''+@ModifiedUser+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+','+''''+CONVERT( NVARCHAR(50), @AuditId)+'''';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+' from #ins i full outer join #del d ';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql + @PKCols;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+' where i.'+@fieldname+' <> d.'+@fieldname;\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+' or (i.'+@fieldname+' is null and d.'+@fieldname+' is not null)';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              SELECT @sql = @sql+' or (i.'+@fieldname+' is not null and d.'+@fieldname+' is null)';\r\n\r\n \r\n\r\n\r\n \r\n\r\n                              --PRINT '-----------sql'\r\n\r\n \r\n\r\n                              --PRINT @sql\r\n\r\n \r\n\r\n                              EXEC (@sql);\r\n\r\n \r\n\r\n                        END;\r\n\r\n \r\n\r\n            END;\r\n\r\n     END;",
          "uses_ansi_nulls": true,
          "uses_quoted_identifier": true,
          "is_schema_bound": false,
          "uses_database_collation": false,
          "is_recompiled": false,
          "null_on_null_input": false,
          "execute_as_principal_id": null,
          "uses_native_compilation": false,
          "inline_type": false,
          "is_inlineable": false
        }
      ]
    }
  ]
}